version: "3"

services:

  workspace:
    image: chrisnharvey/magiclamp-workspace:${MAGICLAMP_VERSION:-1.6}

    volumes:
      - ${PROJECTS_DIR:-./data/projects}:/projects
      - ${SSH_DIR:-./data/ssh}:/home/magicLAMP/.ssh
      - home_dir:/home/magicLAMP
      - /var/run/docker.sock:/var/run/docker.sock
      - .:/magicLAMP

    tty: true

    working_dir: /projects

    dns: 10.0.10.2

    depends_on:
      - dns_internal

    networks:
      app_net:
        ipv4_address: 10.0.10.5

  dns_internal:
    image: chrisnharvey/magiclamp-dns-internal:${MAGICLAMP_VERSION:-1.6}

    dns: ${DNS_RESOLVER:-1.1.1.1}

    networks:
      app_net:
        ipv4_address: 10.0.10.2

  dns:
    image: chrisnharvey/magiclamp-dns:${MAGICLAMP_VERSION:-1.6}

    ports:
      - 127.0.0.1:53:53/udp

    restart: unless-stopped

    dns: ${DNS_RESOLVER:-1.1.1.1}

networks:
  app_net:
    driver: bridge

    driver_opts:
      com.docker.network.enable_ipv6: "false"
    ipam:
      config:
        - subnet: 10.0.10.0/24

volumes:
  home_dir:
